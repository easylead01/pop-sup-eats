

var loader = $('[data-loader]');
var jqBar = $('[data-show-more]');
var jqBarStatus = true;

function getAjaxProducts() {

    var scrollEvent = ($(window).scrollTop() > ((jqBar.position().top - 200) - $(window).height()));

    if (scrollEvent && jqBarStatus) {
        jqBarStatus = false;

        let formData = new FormData();

        formData.append('quantity', $(".cards__column").length);

        _helper.fetch(window.location.href, formData,
            response => {
                response.text()

                    .then(json => {
                        $('.cards__row ').append(json);

                        if (json) {
                            jqBarStatus = true;
                            jqBar.css('opacity', 0);
                            loader.show();
                        } else {
                            loader.remove();
                        }
                    })
            },
            error => {
                loader.hide();
                jqBar.css('opacity', 1);
                console.log("error");
            }
        );
    }
}

function sendGetParam() {
    var min = parseInt($(".price-slider__min").attr("value"), 10);
    var max = parseInt($(".price-slider__max").attr("value"), 10);
    var sort = $('[data-sort-select]').val() ? "&sort=" + $('[data-sort-select]').val() : '';
    document.location.href = location.pathname + "?price_min=" + min + "&price_max=" + max + sort;
}

$(window).scroll(function () {
    getAjaxProducts();
});
$(document).on('click', '[data-show-more]', function () {
    jqBarStatus = true;
    getAjaxProducts();
});
$(document).on('click', '.show-items', function () {
    sendGetParam();
});
$(document).on('change', '[data-sort-select]', function () {
    sendGetParam();
});
$(document).on('click', '.cancel-items', function () {
    var sort = $('[data-sort-select]').val() ? "?sort=" + $('[data-sort-select]').val() : '';
    document.location.href = location.pathname + sort;
});
